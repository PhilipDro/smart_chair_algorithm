<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simulation</title>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
</head>
<body>
<main>
    <div class="table-container">
        <table class="grid" cellspacing="0">
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </table>

        <div id="chairs">
        </div>
    </div>
</main>
<aside>
    <div id="chair-pos" style="background-color: white; padding: 5px; width: 160px">
        <!--gets filled automatically by js-->
    </div>
</aside>

<script>
    //let cam = new WebSocket("ws://10.51.5.64:5678");
    let cam = new WebSocket("ws://10.51.4.206:5678");
    //let cam = new WebSocket("ws://10.51.7.228:5678");
    //let cam = new WebSocket("ws://10.51.7.228:5678");
    const chairs = [];

    cam.onmessage = function (event) {
        let marker = JSON.parse(event.data);
        /*
            Add recognized chairs to array.
            If already  stored, update positions.
         */
        let found = false;
        for (let i = 0; i < chairs.length; i++) {
            if (chairs[i].id === marker.id) {
                chairs[i] = marker;
                found = true;
                break;
            }
        }
        if (!found) {
            chairs.push(marker);
        }

        /*
            Draw all recognized chairs
         */
        drawChairs(chairs);
    };


    function drawChairs(chairs) {
        $('#chairs').empty();
        $('#chair-pos').empty();
        for (let chair of chairs) {
            $('#chairs').append('<div class="chair" id="' + chair.id + '">' + chair.id + '</div>');
            $('#' + chair.id).css({
                left: chair.x + "px",
                top: chair.y + "px",
                transform: "rotate(" + chair.bearing + "deg)"
            });
            $('#chair-pos').append("<p>id: " + chair.id + " bearing: " + Math.round(chair.bearing) + "</p>");
        }
    }
</script>
</body>
</html>