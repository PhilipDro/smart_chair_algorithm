<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simulation</title>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>

</head>
<body>
<style>
    .chair {
        position: absolute;
        left: 0;
        top: 0;
        display: flex;
        justify-content: center;
        background-image: url("https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/apple/198/pouting-face_1f621.png");
        background-size: cover;
        background-position: center;
        width: 40px;
        height: 50px;
        transform: translate(-50%, -50%);
    }
</style>
<main class="simulation">
    <table class="grid" cellspacing="0">
        <tr>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
        <tr>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
        <tr>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
        <tr>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
        <tr>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
    </table>

    <div id="chairs">
    </div>
</main>
<aside>
    <div id="chair-pos" style="background-color: white; padding: 5px">
        <!--gets filled automatically by js-->
    </div>
</aside>

<script>
    //let cam = new WebSocket("ws://10.51.5.64:5678");
    let cam = new WebSocket("ws://10.51.4.206:5678");
    //let cam = new WebSocket("ws://10.51.7.228:5678");
    //let cam = new WebSocket("ws://10.51.7.228:5678");
    const chairs = [];

    cam.onmessage = function (event) {
        let marker = JSON.parse(event.data);
        /*
            Add recognized chairs to array.
            If already  stored, update positions.
         */
        let found = false;
        for (let i = 0; i < chairs.length; i++) {
            if (chairs[i].id === marker.id) {
                chairs[i] = marker;
                found = true;
                break;
            }
        }
        if (!found) {
            chairs.push(marker);
        }

        /*
            Draw all recognized chairs
         */
        drawChairs(chairs);
    };


    function drawChairs(chairs) {
        $('#chairs').empty();
        $('#chair-pos').empty();
        for (let chair of chairs) {
            $('#chairs').append('<div class="chair" id="' + chair.id + '">' + chair.id + '</div>');
            $('#' + chair.id).css({
                left: chair.x + "px",
                top: chair.y + "px",
                transform: "rotate(" + chair.bearing + "deg)"
            });
            $('#chair-pos').append("<p>id: " + chair.id + " bearing: " + Math.round(chair.bearing)+"</p>");
        }
    }
</script>
</body>
</html>